# åº§ä½ç®¡ç†ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

## éƒ¨ç½²æ¦‚è¿°

æœ¬ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäº Vue 3 + TypeScript + Express.js çš„å…¨æ ˆåº§ä½ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒ DevBox ç¯å¢ƒä¸€é”®éƒ¨ç½²ã€‚

## ç³»ç»Ÿè¦æ±‚

- **è¿è¡Œç¯å¢ƒ**: Debian 12 / Ubuntu 18.04+
- **Node.js**: 18.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ•°æ®åº“**: PostgreSQL 12+ ï¼ˆå†…ç½‘è¿æ¥ï¼‰
- **å†…å­˜**: æœ€ä½ 512MBï¼Œæ¨è 1GB+
- **ç£ç›˜**: æœ€ä½ 1GB å¯ç”¨ç©ºé—´

## å¿«é€Ÿéƒ¨ç½²ï¼ˆDevBoxï¼‰

### 1. å‡†å¤‡ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼Œé…ç½®å†…ç½‘æ•°æ®åº“è¿æ¥ï¼š

```bash
# åº”ç”¨é…ç½®
NODE_ENV=production
PORT=3000

# å†…ç½‘æ•°æ®åº“é…ç½®
DB_HOST=127.0.0.1          # å†…ç½‘æ•°æ®åº“åœ°å€
DB_PORT=5432               # æ•°æ®åº“ç«¯å£
DB_NAME=zuowei_db          # æ•°æ®åº“åç§°
DB_USER=postgres           # æ•°æ®åº“ç”¨æˆ·å
DB_PASSWORD=your_password  # æ•°æ®åº“å¯†ç 
DB_SSL=false              # å†…ç½‘è¿æ¥ä¸ä½¿ç”¨SSL

# è¿æ¥æ± é…ç½®
DB_MAX_CONNECTIONS=20
DB_IDLE_TIMEOUT=30000
DB_CONNECTION_TIMEOUT=5000
```

### 2. ä¸€é”®éƒ¨ç½²

åœ¨ DevBox ç¯å¢ƒä¸­è¿è¡Œï¼š

```bash
bash entrypoint.sh
```

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
- âœ… æ£€æŸ¥ Node.js ç¯å¢ƒ
- ğŸ“¦ å®‰è£…é¡¹ç›®ä¾èµ–
- ğŸ”¨ æ„å»ºå‰ç«¯å’Œåç«¯
- ğŸ”— æµ‹è¯•æ•°æ®åº“è¿æ¥
- ğŸš€ å¯åŠ¨åº”ç”¨æœåŠ¡

### 3. éªŒè¯éƒ¨ç½²

éƒ¨ç½²æˆåŠŸåï¼Œè®¿é—®ä»¥ä¸‹åœ°å€éªŒè¯ï¼š

- **åº”ç”¨é¦–é¡µ**: http://your-server:3000
- **å¥åº·æ£€æŸ¥**: http://your-server:3000/api/health
- **APIæ¥å£**: http://your-server:3000/api/*

## Docker éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

### 1. æ„å»ºé•œåƒ

```bash
docker build -t zuowei-seating-system .
```

### 2. è¿è¡Œå®¹å™¨

```bash
docker run -d \
  --name zuowei-app \
  -p 3000:3000 \
  -e DB_HOST=host.docker.internal \
  -e DB_PORT=5432 \
  -e DB_NAME=zuowei_db \
  -e DB_USER=postgres \
  -e DB_PASSWORD=your_password \
  zuowei-seating-system
```

## æ•°æ®åº“å‡†å¤‡

### PostgreSQL å†…ç½‘è¿æ¥é…ç½®

ç¡®ä¿ PostgreSQL æœåŠ¡å™¨é…ç½®å…è®¸å†…ç½‘è¿æ¥ï¼š

1. **ç¼–è¾‘ postgresql.conf**ï¼š
```sql
listen_addresses = 'localhost,å†…ç½‘IP'
port = 5432
```

2. **ç¼–è¾‘ pg_hba.conf**ï¼š
```
# å…è®¸å†…ç½‘è¿æ¥
host    zuowei_db    postgres    127.0.0.1/32    trust
host    zuowei_db    postgres    å†…ç½‘æ®µ/24       md5
```

3. **åˆ›å»ºæ•°æ®åº“**ï¼š
```sql
CREATE DATABASE zuowei_db;
CREATE USER postgres WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE zuowei_db TO postgres;
```

## ç³»ç»ŸåŠŸèƒ½

- ğŸª‘ **åº§ä½ç®¡ç†**: åŠ¨æ€é…ç½®æ¡Œæ•°å’Œåº§ä½æ•°
- ğŸ‘¥ **äººå‘˜ç®¡ç†**: æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤äººå‘˜ä¿¡æ¯
- ğŸ¯ **ä¼ æ’­å¤§ä½¿**: ç®¡ç†ä¼ æ’­å¤§ä½¿å’Œå…³è”äººå‘˜
- ğŸ”„ **æ‹–æ‹½åˆ†é…**: ç›´è§‚çš„æ‹–æ‹½æ“ä½œåˆ†é…åº§ä½
- ğŸ’¾ **æ•°æ®æŒä¹…åŒ–**: PostgreSQL æ•°æ®åº“å­˜å‚¨
- ğŸ“± **å“åº”å¼è®¾è®¡**: æ”¯æŒå¤šè®¾å¤‡è®¿é—®

## ç›‘æ§å’Œæ—¥å¿—

### åº”ç”¨æ—¥å¿—
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
journalctl -u zuowei-app -f

# æˆ–æŸ¥çœ‹ Docker æ—¥å¿—
docker logs -f zuowei-app
```

### å¥åº·æ£€æŸ¥
```bash
curl http://localhost:3000/api/health
```

è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "success": true,
  "message": "æ’åº§ä½è¡¨ç³»ç»Ÿè¿è¡Œæ­£å¸¸",
  "database": "å·²è¿æ¥",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "version": "1.0.0"
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦è¿è¡Œ
   - éªŒè¯å†…ç½‘è¿æ¥é…ç½®
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

2. **ç«¯å£å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tulpn | grep :3000
   
   # åœæ­¢å ç”¨è¿›ç¨‹
   sudo kill -9 PID
   ```

3. **æƒé™é—®é¢˜**
   ```bash
   # ç»™è„šæœ¬æ‰§è¡Œæƒé™ï¼ˆLinuxï¼‰
   chmod +x entrypoint.sh
   
   # æ£€æŸ¥æ–‡ä»¶æƒé™
   ls -la entrypoint.sh
   ```

### æ—¥å¿—åˆ†æ

- **åº”ç”¨å¯åŠ¨æ—¥å¿—**: æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–æˆ–é…ç½®é”™è¯¯
- **æ•°æ®åº“æ—¥å¿—**: éªŒè¯è¿æ¥å’ŒæŸ¥è¯¢æ‰§è¡Œ
- **ç½‘ç»œæ—¥å¿—**: æ£€æŸ¥å†…ç½‘è¿é€šæ€§

## æ€§èƒ½ä¼˜åŒ–

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

1. **èµ„æºé…ç½®**ï¼š
   - CPU: 2æ ¸+
   - å†…å­˜: 2GB+
   - ç£ç›˜: SSDï¼Œ10GB+

2. **æ•°æ®åº“ä¼˜åŒ–**ï¼š
   - é…ç½®è¿æ¥æ± ï¼šæœ€å¤§20è¿æ¥
   - å¯ç”¨æŸ¥è¯¢ç¼“å­˜
   - å®šæœŸç»´æŠ¤å’Œå¤‡ä»½

3. **åº”ç”¨ä¼˜åŒ–**ï¼š
   - å¯ç”¨ Gzip å‹ç¼©
   - é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰
   - ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ

## å¤‡ä»½å’Œæ¢å¤

### æ•°æ®åº“å¤‡ä»½
```bash
# å¤‡ä»½æ•°æ®åº“
pg_dump -h localhost -U postgres zuowei_db > backup.sql

# æ¢å¤æ•°æ®åº“
psql -h localhost -U postgres zuowei_db < backup.sql
```

### åº”ç”¨å¤‡ä»½
```bash
# å¤‡ä»½åº”ç”¨ä»£ç å’Œé…ç½®
tar -czf zuowei-backup-$(date +%Y%m%d).tar.gz \
  /path/to/zuowei \
  --exclude=node_modules \
  --exclude=dist \
  --exclude=.git
```

## æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç³»ç»Ÿè¦æ±‚æ˜¯å¦æ»¡è¶³
2. ç¯å¢ƒå˜é‡é…ç½®æ˜¯å¦æ­£ç¡®
3. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
4. åº”ç”¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ›´å¤šæŠ€æœ¯æ”¯æŒã€‚
